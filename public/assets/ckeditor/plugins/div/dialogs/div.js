(function(){function e(e,t,a){t.is&&t.getCustomData("block_processed")||(t.is&&CKEDITOR.dom.element.setMarker(a,t,"block_processed",!0),e.push(t))}function t(t,a){function i(){this.foreach(function(e){/^(?!vbox|hbox)/.test(e.type)&&(e.setup||(e.setup=function(t){e.setValue(t.getAttribute(e.id)||"",1)}),!e.commit)&&(e.commit=function(t){var a=this.getValue();"dir"==e.id&&t.getComputedStyle("direction")==a||(a?t.setAttribute(e.id,a):t.removeAttribute(e.id))})})}var n=function(){var e=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);return t.config.div_wrapTable&&(delete e.td,delete e.th),e}(),o=CKEDITOR.dtd.div,r={},l=[];return{title:t.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:t.lang.common.generalTab,title:t.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:t.lang.div.styleSelectLabel,"default":"",items:[[t.lang.common.notSet,""]],onChange:function(){var e=["info:elementStyle","info:class","advanced:dir","advanced:style"],a=this.getDialog(),i=a._element&&a._element.clone()||new CKEDITOR.dom.element("div",t.document);this.commit(i,!0);for(var n,e=[].concat(e),o=e.length,r=0;o>r;r++)(n=a.getContentElement.apply(a,e[r].split(":")))&&n.setup&&n.setup(i,!0)},setup:function(e){for(var t in r)r[t].checkElementRemovable(e,!0)&&this.setValue(t,1)},commit:function(e){var t;(t=this.getValue())?r[t].applyToObject(e):e.removeAttribute("style")}},{id:"class",type:"text",requiredContent:"div(cke-xyz)",label:t.lang.common.cssClass,"default":""}]}]},{id:"advanced",label:t.lang.common.advancedTab,title:t.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",requiredContent:"div[id]",label:t.lang.common.id,"default":""},{type:"text",id:"lang",requiredContent:"div[lang]",label:t.lang.common.langCode,"default":""}]},{type:"hbox",children:[{type:"text",id:"style",requiredContent:"div{cke-xyz}",style:"width: 100%;",label:t.lang.common.cssStyle,"default":"",commit:function(e){e.setAttribute("style",this.getValue())}}]},{type:"hbox",children:[{type:"text",id:"title",requiredContent:"div[title]",style:"width: 100%;",label:t.lang.common.advisoryTitle,"default":""}]},{type:"select",id:"dir",requiredContent:"div[dir]",style:"width: 100%;",label:t.lang.common.langDir,"default":"",items:[[t.lang.common.notSet,""],[t.lang.common.langDirLtr,"ltr"],[t.lang.common.langDirRtl,"rtl"]]}]}]}],onLoad:function(){i.call(this);var e=this,a=this.getContentElement("info","elementStyle");t.getStylesSet(function(i){var n,o;if(i)for(var l=0;i.length>l;l++)o=i[l],o.element&&"div"==o.element&&(n=o.name,r[n]=o=new CKEDITOR.style(o),t.filter.check(o)&&(a.items.push([n,n]),a.add(n,n)));a[a.items.length>1?"enable":"disable"](),setTimeout(function(){e._element&&a.setup(e._element)},0)})},onShow:function(){"editdiv"==a&&this.setupContent(this._element=CKEDITOR.plugins.div.getSurroundDiv(t))},onOk:function(){if("editdiv"==a)l=[this._element];else{var i,r,s,d=[],c={},u=[],m=t.getSelection(),p=m.getRanges(),g=m.createBookmarks();for(r=0;p.length>r;r++)for(s=p[r].createIterator();i=s.getNextParagraph();)if(i.getName()in n){var h=i.getChildren();for(i=0;h.count()>i;i++)e(u,h.getItem(i),c)}else{for(;!o[i.getName()]&&!i.equals(p[r].root);)i=i.getParent();e(u,i,c)}for(CKEDITOR.dom.element.clearAllMarkers(c),p=[],r=null,s=0;u.length>s;s++)i=u[s],h=t.elementPath(i).blockLimit,t.config.div_wrapTable&&h.is(["td","th"])&&(h=t.elementPath(h.getParent()).blockLimit),h.equals(r)||(r=h,p.push([])),p[p.length-1].push(i);for(r=0;p.length>r;r++){for(h=p[r][0],u=h.getParent(),i=1;p[r].length>i;i++)u=u.getCommonAncestor(p[r][i]);for(s=new CKEDITOR.dom.element("div",t.document),i=0;p[r].length>i;i++){for(h=p[r][i];!h.getParent().equals(u);)h=h.getParent();p[r][i]=h}for(i=0;p[r].length>i;i++)h=p[r][i],h.getCustomData&&h.getCustomData("block_processed")||(h.is&&CKEDITOR.dom.element.setMarker(c,h,"block_processed",!0),i||s.insertBefore(h),s.append(h));CKEDITOR.dom.element.clearAllMarkers(c),d.push(s)}m.selectBookmarks(g),l=d}for(d=l.length,c=0;d>c;c++)this.commitContent(l[c]),!l[c].getAttribute("style")&&l[c].removeAttribute("style");this.hide()},onHide:function(){"editdiv"==a&&this._element.removeCustomData("elementStyle"),delete this._element}}}CKEDITOR.dialog.add("creatediv",function(e){return t(e,"creatediv")}),CKEDITOR.dialog.add("editdiv",function(e){return t(e,"editdiv")})})();